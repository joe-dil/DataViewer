---
description: 
globs: 
alwaysApply: true
---
## **Do Not Break:**
1. **Existing function signatures** in `include/viewer.h` - other files depend on these
2. **DSVViewer struct layout** - display.c and cache.c access fields directly  
3. **Git history** - commit after each successful phase

## **Memory Management:**
1. **Every malloc needs corresponding free** in cleanup functions
2. **Check all realloc calls** for failure handling
3. **Null pointer checks** before all free() calls
4. **Initialize all pointers to NULL** in init functions

## **Header Dependencies:**
1. **Avoid circular includes** - use forward declarations
2. **Include guards** required in all new headers
3. **Minimal includes** - only include what's directly used

## **Testing Requirements:**
1. **Test after every function move** - don't batch changes
2. **Verify edge cases** especially empty files and single lines
3. **Check timing output** to ensure no performance regression
4. **Test all navigation keys** to ensure redraw fixes work